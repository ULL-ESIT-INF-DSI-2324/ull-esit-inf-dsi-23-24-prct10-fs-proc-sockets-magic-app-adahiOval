<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>p07</title><meta name="description" content="Documentation for p07"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">p07</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>p07</h2></div><div class="tsd-panel tsd-typography"><p><a href="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct09-filesystem-magic-app-adahi-oval/actions/workflows/node.js.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct09-filesystem-magic-app-adahi-oval/actions/workflows/node.js.yml/badge.svg?branch=main" alt="Tests"></a></p>
<p><a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct09-filesystem-magic-app-adahi-oval?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct09-filesystem-magic-app-adahi-oval/badge.svg?branch=main" alt="Coverage Status"></a></p>
<p><a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct09-filesystem-magic-app-adahi-oval"><img src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct09-filesystem-magic-app-adahi-oval&metric=alert_status" alt="Quality Gate Status"></a></p>
<a id="md:introducción" class="tsd-anchor"></a><h2><a href="#md:introducción">Introducción</a></h2><p>En esta práctica se presenta 1 ejercicio para familiarizarnos con el modulo yargs y el modulo chalk, así como con los principios SOLID. Para ello se han desarrollado este ejercicio en la carpeta <code>src</code> y sus correspondientes pruebas en la carpeta <code>test</code>. </p>
<p>Para la instalación de las dependencias necesarias para hacer funcionar el código solo es necesario el comando:</p>
<pre><code class="language-bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span>
</code><button>Copy</button></pre>
<a id="md:objetivos" class="tsd-anchor"></a><h2><a href="#md:objetivos">Objetivos</a></h2><p>Los objetivos de esta práctica son la familiarización con los modulos yargs y chalk, así como los principios SOLID de programación orientada a objetos y también la implementación de coveralls en nuestro código. </p>
<a id="md:clases" class="tsd-anchor"></a><h2><a href="#md:clases">Clases</a></h2><p>Las clases desarrolladas para esta práctica son las siguientes:</p>
<ul>
<li>Card: Clase base de los distintos tipos de cartas, con sus correspondientes atributos</li>
<li>CardCollection: Coleccion de cartas.</li>
<li>CardCollectionReader: Lector de Coleccion de cartas a partir de un directorio de un usuario</li>
<li>CardCollectionPrinter: Printer de una coleccion de cartas dada</li>
<li>CardCollectionWriter: Escritor de la coleccion de cartas en el directorio del usuario de la misma</li>
<li>CardReader: Lector de carta individual a partir de un objeto JSON</li>
</ul>
<a id="md:card" class="tsd-anchor"></a><h3><a href="#md:card">Card</a></h3><p>Esta es la clase base de los distintos tipos de cartas. Es una clase abstracta cuyo constructor tiene los atributos mínimos compartidos por todas las cartas. De ella se crea una clase diferente para cada tipo de carta:</p>
<ul>
<li>Tierra</li>
<li>Encantamiento</li>
<li>Conjuro</li>
<li>Instantaneo</li>
<li>Artefacto</li>
<li>Criatura: Con el atributo adicional <code>stats</code></li>
<li>Planeswalker: Con el atributo adicional <code>loyalty</code></li>
</ul>
<p>También se define un método abstracto <code>print()</code> que cada una de las clases hijas implementa propiamente.</p>
<a id="md:cardcollection" class="tsd-anchor"></a><h3><a href="#md:cardcollection">CardCollection</a></h3><p>Esta es la clase que representa una colección de cartas de un usuario dado. Su constructor recibe un array de objetos tipo <code>Card</code> y un string con el nombre de usuario. Dentro de esta clase se encuentran los siguientes métodos:</p>
<ul>
<li><code>addCard</code>: Este es el método para añadir una carta a la colección, se le pasa una carta por parámetro y la añade al array de cartas de la colección</li>
<li><code>updateCard</code>: Este método modifica una carta existente, se le pasa una carta y elimina la carta existente con el mismo ID y añade la nueva carta dada por parametro.</li>
<li><code>deleteCard</code>: Este método elimina una carta de la colección, se le pasa un ID por parámetro que comprueba si existe primero y luego filtra la colección para que devuelva un nuevo array con los IDs que no coinciden.</li>
<li><code>showCard</code>: Este método muestra la información de una sola carta por consola, se le pasa un ID que busca en la colección e invoca el método print de la carta concreta.</li>
<li><code>listCollection</code>: Este método lista todas las cartas de la colección, para ello crea un objeto <code>CardCollectionPrinter</code> que toma la propia coleccion, y luego invoca a su método print que a su vez invoca el metodo print de todas las cartas de la colección.</li>
</ul>
<a id="md:cardcollectionreader" class="tsd-anchor"></a><h3><a href="#md:cardcollectionreader">CardCollectionReader</a></h3><p>Esta clase se encarga de leer las cartas del directorio de un usuario dado. Para ello, se le pasa el nombre de usuario en el constructor, que se encarga de crear la ruta relativa al directorio del usuario utilizando el módulo <code>path</code> de la siguiente manera:</p>
<pre><code class="language-typescript"><span class="hl-0">constructor</span><span class="hl-1">(</span><span class="hl-3">private</span><span class="hl-1"> </span><span class="hl-3">user</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">__dirname</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">dirname</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">URL</span><span class="hl-1">(</span><span class="hl-6">import</span><span class="hl-1">.</span><span class="hl-3">meta</span><span class="hl-1">.</span><span class="hl-3">url</span><span class="hl-1">).</span><span class="hl-3">pathname</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fatherdir</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">(</span><span class="hl-3">__dirname</span><span class="hl-1">, </span><span class="hl-2">&#39;..&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-3">route</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-3">fatherdir</span><span class="hl-1">, </span><span class="hl-2">`database/users/</span><span class="hl-4">${</span><span class="hl-4">this</span><span class="hl-7">.</span><span class="hl-3">user</span><span class="hl-4">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Luego hace uso de un método <code>readDir</code> que lee todo el directorio con la ruta anterior, probando su existencia primero, y para cada archivo encontrado, llama al método <code>JSON.parse</code> y crea un objeto <code>CardReader</code> con ese resultado, luego hace uso del método <code>returnCard</code> del objeto <code>CardReader</code> que devuelve una Carta ya creada y la añade al array de la colección:</p>
<pre><code class="language-typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">cards</span><span class="hl-1"> = </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">readdirSync</span><span class="hl-1">(</span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-3">route</span><span class="hl-1">);</span><br/><br/><span class="hl-3">cards</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-3">card</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">content</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> = </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">readFileSync</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-4">${</span><span class="hl-4">this</span><span class="hl-7">.</span><span class="hl-3">route</span><span class="hl-4">}</span><span class="hl-2">/</span><span class="hl-4">${</span><span class="hl-3">card</span><span class="hl-4">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-2">&#39;utf-8&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">data</span><span class="hl-1">: </span><span class="hl-8">CardShape</span><span class="hl-1"> = </span><span class="hl-5">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-3">content</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">reader</span><span class="hl-1">: </span><span class="hl-8">CardReader</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">CardReader</span><span class="hl-1">(</span><span class="hl-3">data</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-3">collection</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-3">reader</span><span class="hl-1">.</span><span class="hl-0">returnCard</span><span class="hl-1">());</span><br/><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:cardcollectionwriter" class="tsd-anchor"></a><h3><a href="#md:cardcollectionwriter">CardCollectionWriter</a></h3><p>Esta es la clase encargada de escribir los resultados de las operaciones sobre la colección en el directorio del usuario inicial. Para ello, hace uso del método <code>write()</code> que primero borra todos los archivos del directorio del usuario, para luego escribir las cartas de la colección cada una en un archivo <code>JSON</code> separado. Se ha optado por esta forma ya que simplifica mucho el manejo del sistema de archivos del ordenador.</p>
<pre><code class="language-typescript"><span class="hl-0">write</span><span class="hl-1">(): </span><span class="hl-4">void</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">files</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">[] = </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">readdirSync</span><span class="hl-1">(</span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-3">route</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">files</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-3">file</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">filePath</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-3">route</span><span class="hl-1">, </span><span class="hl-3">file</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">unlinkSync</span><span class="hl-1">(</span><span class="hl-3">filePath</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-3">collection</span><span class="hl-1">.</span><span class="hl-3">collection</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-3">card</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">cardPath</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-3">route</span><span class="hl-1">, </span><span class="hl-2">`</span><span class="hl-4">${</span><span class="hl-3">card</span><span class="hl-7">.</span><span class="hl-3">name</span><span class="hl-4">}</span><span class="hl-2">.json`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">writeFileSync</span><span class="hl-1">(</span><span class="hl-3">cardPath</span><span class="hl-1">, </span><span class="hl-5">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-3">card</span><span class="hl-1">));</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:magic-appts" class="tsd-anchor"></a><h2><a href="#md:magic-appts">magic-app.ts</a></h2><p>Este es el archivo principal del ejercicio. En él se utiliza el módulo <code>yargs</code> para parsear los argumentos dados por la línea de comandos y ejecutar la lógica del programa según corresponda. Para ello, se hacen uso de llamadas a <code>.command</code> una por cada operación que podamos hacer sobre la colección, estas son:</p>
<ul>
<li>add: añadir una carta</li>
<li>remove: elminar una carta</li>
<li>update: modificar una carta</li>
<li>read: mostrar una carta por ID</li>
<li>list: mostrar todas las cartas</li>
</ul>
<p>El orden de ejecución de cada comando es el siguiente:</p>
<ol>
<li>Se crea un objeto <code>CardCollectionReader</code> que lee el directorio del usuario dado en el parámetro <code>--user</code>.</li>
<li>Se crea un objeto <code>CardCollection</code> a partir de la colección leída en el paso anterior.</li>
<li>Se crea una carta (si fuese necesario) con los datos pasados por línea de comandos.</li>
<li>Se llama al método de <code>CardCollection</code> correspondiente a la operación dada, por ejemplo <code>addCard()</code> en caso de que sea un comando <code>add</code>.</li>
<li>Se crea un objeto <code>CardCollectionWriter</code> a partir de la nueva colección.</li>
<li>Se escribe la nueva colección en el directorio del usuario.</li>
</ol>
<a id="md:ejercicio-pe" class="tsd-anchor"></a><h2><a href="#md:ejercicio-pe">Ejercicio PE</a></h2><p>En el ejercicio PE de esta semana, se ha trabajado con la API Síncrona de Node así como con el patrón de diseño <strong>Plantilla</strong> o <em><strong>Template</strong></em>. Para ello se desarrolló una clase abstracta <code>BagReader</code>, y de ella dos clases concretas <code>JSONReader</code> y <code>CSVReader</code>. En cada una de ella se implementaba el método <code>procesar()</code> que según la clase se implementaba para parsear argumentos de diferente manera, en el caso de CSV se tomaban en cuenta las comas y el orden para parsear los argumentos y retornar los beneficios y los pesos. Y en el caso de JSON se utilizaba <code>JSON.parse</code> para leer los diferentes campos en objetos con una forma estipulada por interfaces <code>BagJSON</code>y <code>ElementJSON</code>.</p>
<a id="md:conclusiones" class="tsd-anchor"></a><h2><a href="#md:conclusiones">Conclusiones</a></h2><p>En esta práctica se ha profundizado en el desarrollo de código según los principios SOLID, así como familiarizarse con el uso de módulos <code>chalk</code> y <code>yargs</code>, así como de la API Síncrona de Node.js para el manejo del sistema de archivos. También del cubrimiento del código mediante Coveralls y la gestión de calidad mediante SonarCloud.</p>
<a id="md:bibliografía" class="tsd-anchor"></a><h2><a href="#md:bibliografía">Bibliografía</a></h2><ul>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/typescript-theory/">Apuntes de la asignatura</a><ul>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/typescript-theory/typescript-solid.html">Principios SOLID</a></li>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/typescript-theory/typescript-patterns.html#strategy">Patrones de diseño en typescript</a></li>
</ul>
</li>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/nodejs-theory/">Apuntes de la asignatura sobre Node.js</a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:introducción"><span>Introducción</span></a><a href="#md:objetivos"><span>Objetivos</span></a><a href="#md:clases"><span>Clases</span></a><ul><li><a href="#md:card"><span>Card</span></a></li><li><a href="#md:cardcollection"><span>Card<wbr/>Collection</span></a></li><li><a href="#md:cardcollectionreader"><span>Card<wbr/>Collection<wbr/>Reader</span></a></li><li><a href="#md:cardcollectionwriter"><span>Card<wbr/>Collection<wbr/>Writer</span></a></li></ul><a href="#md:magic-appts"><span>magic-<wbr/>app.ts</span></a><a href="#md:ejercicio-pe"><span>Ejercicio PE</span></a><a href="#md:conclusiones"><span>Conclusiones</span></a><a href="#md:bibliografía"><span>Bibliografía</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>p07</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><div class="tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div></body></html>